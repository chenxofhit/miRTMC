#parse("/WEB-INF/views/container/header.html")

<body>
	<div class="container">
		#parse("/WEB-INF/views/container/menu.html")
		<div class="tab-content">
			<div class="tab-pane active fade in" id="index">
				<h2>
					<strong class="text-uppercase"><span
						class="glyphicon glyphicon-info-sign"> </span>miRTMC</strong>
				</h2>
				<hr class="G-MarginTop20">
				<div class="row">
					<p class="text-default alert alert-info G-MarginTop20 miRTMC-brief">
						microRNAs (miRNAs) are small non-coding RNAs which modulate the
						stability of mRNA targets and their rates of translation into
						proteins at transcriptional level and posttranscriptional level.
						miRNA dysfunctions can lead to human diseases because of
						dysregulation of their targets. Correct miRNA target prediction
						will lead to better understanding of the mechanisms of human
						diseases and provide hints on curing them. Here, we developed a
						new miRNA targets predictor, miRTMC (miRNA targets prediction
						based on matrix completion), by integrating miRNA sequence
						similarity, gene sequence similarity and known miRNA targets. You
						can enter the miRNA name or gene symbol (Entrez Gene ID) to query
						the recommendation results that we have calculated. If the name or
						id you entered does not exist in our computed results, please
						provide the corresponding miRNA sequence or 3'UTR sequence, and
						the calculation result will be given.</p>
				</div>

				<div class="radio-group">

					<form id="mirtmc-calculate" class="form-horizontal"
						action="${BAST_PATH}/index/submit" method="post">

						<div class="col-xs-10 form-group field-input">
							<label for="radio-group" class="formbuilder-radio-group-label">Select
								an option to search: </label> <input name="option" id="option" value="1"
								type="radio" checked="checked"><label for="radio-group">MiRNA
								name</label>
							<!-- 								<input name="option" id="option" value="2" type="radio"><label -->
							<!-- 								for="radio-group">Refseq_ID</label>  -->
							<input name="option" id="option" value="3" type="radio">
							<label for="radio-group">Gene symbol</label> <input name="option"
								id="option" value="4" type="radio"><label
								for="radio-group">Entrez Gene ID</label>
						</div>

						<div class="col-xs-10 form-group field-input" id="selfinput">
							<input type="text"
								placeholder="Please input the value with the selected option，and then click other place anywhere"
								class="form-control" name="content" maxlength="20" id="input"
								onblur="checkQueryKeyExsit();">
						</div>

						<div class="col-xs-10" id="fastainput">
							<span class="text-info">As the search value is not hit in
								our provided results, please then input the Corresponding
								Sequence(one sequence, <a
								href="http://en.wikipedia.org/wiki/Fasta_format"
								target="__blank">FASTA Format</a>):
							</span><a class="btn btn-link" id="example" style="margin-left: 1%">load
								example</a>
							<textarea style="height: 300px;" type="text"
								placeholder="Please input the LncSeqs you want to search in fasta format"
								class="form-control" id="sequence" name="sequence"></textarea>
							<!-- email -->
							<div class="row form-group G-MarginTop20" id="email_div">
								<div class="col-xs-10 text-info">
									Your Email(*, the results will be delivered here):<span
										class="text-default"><input type="text" id="email"
										name="email"></span>
								</div>
							</div>

							<hr class="row ">
						</div>

						<div class="col-xs-10" id="submit">
							<div class="row">
								<button type="submit" class="btn btn-info btn-small pull-left"
									id="submitbtn">Submit</button>
							</div>
						</div>
					</form>
				</div>

			</div>
			<div class="tab-pane" id="readme">
				<h2>
					<strong class="text-uppercase"><span
						class="glyphicon glyphicon-info-sign"> </span>Read Me</strong>
				</h2>
				<hr class="G-MarginTop20">
				#include("/WEB-INF/views/container/readme.html")
			</div>
			<div class="tab-pane" id="about">
				<h2>
					<strong class="text-uppercase"><span
						class="glyphicon glyphicon-info-sign"> </span>About</strong>
				</h2>
				<hr class="G-MarginTop20">
				<p class="text-default alert alert-info G-MarginTop20 ldap-brief">miRTMC
					is a non-profit tool used to provide predict severs for miRNA
					target.</p>
				<p class="text-default alert alert-info G-MarginTop20 ldap-brief">Questions
					and comments on the tool and suggestions for improvement to the
					website are always welcome.</p>
				<h3>
					<strong><span class="glyphicon  glyphicon-envelope"></span>
						Please contact:</strong>
				</h3>
				<p>
					Hui Jiang: <a href="mailto:jianghui@csu.edu.cn">jianghui@csu.edu.cn</a>
				<p>
					Xiang chen:<a href="mailto:  @csu.edu.cn">
						chenxofhit@@gmail.com</a>
				<p>
					Jianxin Wang:<a href="mailto:jxwang@mail.csu.edu.cn">
						jxwang@mail.csu.edu.cn</a>
				<p>
					Min Li: <a href="mailto:limin@mail.csu.edu.cn">limin@mail.csu.edu.cn</a>
			</div>
			<div class="tab-pane" id="result">
				<h2>
					<strong class="text-uppercase"><span
						class="glyphicon glyphicon-info-sign"> </span>Result</strong>
				</h2>
				<hr class="G-MarginTop20">
				<p class="text-default alert alert-info G-MarginTop20 ldap-brief">You
					can check out the result for your submit by the jobid</p>
				<!-- <div class="row">
                   <div class="col-xs-1"></div> -->
				<form class="form-horizontal col-xs-10"
					action="${BAST_PATH}/checkresult" method="post" id="check-result">
					<!-- 					<div class="row form-group G-MarginTop20">
						Email: <input type="text" id="check_email" name="check_email"
							placeholder="input your email" data-bv-notempty
							data-bv-emailAddress
							data-bv-message="please input the right email">
					</div> -->
					<div class="row form-group G-MarginTop20">
						Jobid: <input type="text" id="check_jobid" name="check_jobid"
							placeholder="input your jobid" data-bv-notempty data-bv-numeric
							data-bv-message="please input the right jobid">
					</div>
					<button type="submit" class="btn btn-info btn-small" id="result-go">GO</button>
				</form>
			</div>
		</div>
		#include("/WEB-INF/views/container/footer.html")
	</div>
	<script type="text/javascript">
		jQuery(function($) {
			$("#selfinput").show();
			$("#fastainput").hide();
			$("#submit").hide();

			$("#mirtmc-calculate input[type=radio]").change(function() {
				$("#selfinput").show();
				$("#fastainput").hide();
				$("#submit").hide();
			});
		})

		function checkQueryKeyExsit() {
			jQuery(function($) {
				$
						.ajax({
							url : "${BAST_PATH}/checkQueryKeyExsit.json",
							type : "POST",
							data : {
								option : $("#mirtmc-calculate input[type='radio']:checked")
										.val(),
								content : $("#input").val(),
							},
							success : function(response) {
								if (response == true) {
									$("#fastainput").hide();
									$("#selfinput").show();

								} else {
									$("#fastainput").show();
									$("#sequence").val("");
									$("#selfinput").hide();
								}
								$("#submit").show();
							},
							error : function() {
								alert("System error, please try later...");
							}
						})
			})
		}

		jQuery.noConflict();
		(function($) {

			//显示提示消息
			//info表示要提示的信息
			function alert_info(info) {
				$('#myModal').modal('show');
				$('#info-body').html(info);
			}

			//去除空格
			//自定义trim，防止trim失效
			function trimStr(str) {
				return str.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g, "");
			}

			$(function() {
				//提交计算校验
				$("#submitbtn")
						.on("click",
								function() {
									if ($("#fastainput").is(":hidden")) {
										return true;
									}

									var emailAddress = /^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/;
									var sequence = trimStr($("#sequence").val());
									var email = trimStr($("#email").val());

									/* 									alert(sequence + email); */
									/* 									if ($('input[name="file"]').prop('files').length <= 0
									 && sequence.length <= 0) {
									 alert_info("Please input a sequence or a file...");
									 return false;
									 } else { */
									var counter = 0;

									if ($("#email_div").css("display") == "block") {
										if (emailAddress.test(email)) {
											//$("#mirtmc-calculate").submit();
											counter++;
											// return true;
										} else {
											alert_info("The email is not valid");
											//alert("The email is not valid");
											$("#email_div").focus();
											return false;
										}
									}
									if (sequence.length >= 0) {
										var sequence_pattern = new RegExp(
												"^[agctuAGCTU]*$");
										var arr = sequence.split(/\r\n|\r|\n/);
										console.log(arr);
										if (arr.length == 2) {
											var LncSeq = trimStr(arr[1]);
											// console.log(trimStr(arr[1])));
											console.log(sequence_pattern
													.test(LncSeq));
											if (sequence_pattern.test(LncSeq)) {
												// return false;
												counter++;

											} else {
												alert_info("The sequence has invalid characters");
												return false;
											}
										} else {
											alert_info("The sequence is not valid");
											return false;
										}
									} else {
										alert_info("The sequence or the file is not valid");
										//alert("The sequence or the email is not valid");
										return false;
									}

									if (counter >= 2) {
										$("#mirtmc-calculate").submit();
									}
									/* 									} */
								});

				//查看提交结果
				$("#check-result").on(
						"click",
						function() {
							$("#check-result").bootstrapValidator();
							var isValid = $('#check-result').data(
									'bootstrapValidator').isValid();
							if (isValid) {
								$("#check-result").submit();
							}
						});

				$("#example")
						.click(
								function() {
									var example = ">hsa-let-7a-5p\nUGAGGUAGUAGGUUGUAUAGUU";
									var sel = $("input:radio:checked").val();
									if (sel == "3" || sel == "4") {
										example = ">NM_001243084\nGCTTTTTCTTAATTTCATTCCTTTTTTTGGACACTGGTGGCTCATTACCTAAAGCAGTCTATTTATATTTTCTACATCTAATTTTAGAAGCCTGGCTACAATACTGCACAAACTTGGTTAGTTCAATTTTGATCCCCTTTCTACTTAATTTACATTAATGCTCTTTTTTAGTATGTTCTTTAATGCTGGATCACAGACAGCTCATTTTCTCAGTTTTTTGGTATTTAAACCATTGCATTGCAGTAGCATCATTTTAAAAAATGCACCTTTTTATTTATTTATTTTTGGCTAGGGAGTTTATCCCTTTTTCGAATTATTTTTAAGAAGATGCCAATATAATTTTTGTAAGAAGGCAGTAACCTTTCATCATGATCATAGGCAGTTGAAAAATTTTTACACCTTTTTTTTCACATTTTACATAAATAATAATGCTTTGCCAGCAGTACGTGGTAGCCACAATTGCACAATATATTTTCTTAAAAAATACCAGCAGTTACTCATGGAATATATTCTGCGTTTATAAAACTAGTTTTTAAGAAGAAATTTTTTTTGGCCTATGAAATTGTTAAACCTGGAACATGACATTGTTAATCATATAATAATGATTCTTAAATGCTGTATGGTTTATTATTTAAATGGGTAAAGCCATTTACATAATATAGAAAGATATGCATATATCTAGAAGGTATGTGGCATTTATTTGGATAAAATTCTCAATTCAGAGAAATCATCTGATGTTTCTATAGTCACTTTGCCAGCTCAAAAGAAAACAATACCCTATGTAGTTGTGGAAGTTTATGCTAATATTGTGTAACTGATATTAAACCTAAATGTTCTGCCTACCCTGTTGGTATAAAGATATTTTGAGCAGACTGTAAACAAGAAAAAAAAAATCATGCATTCTTAGCAAAATTGCCTAGTATGTTAATTTGCTCAAAATACAATGTTTGATTTTATGCACTTTGTCGCTATTAACATCCTTTTTTTCATGTAGATTTCAATAATTGAGTAATTTTAGAAGCATTATTTTAGGAATATATAGTTGTCACAGTAAATATCTTGTTTTTTCTATGTACATTGTACAAATTTTTCATTCCTTTTGCTCTTTGTGGTTGGATCTAACACTAACTGTATTGTTTTGTTACATCAAATAAACATCTTCTGTGGACCAGGC";
									}
									$("#sequence").val(example);
									$("#sequence")[0].focus();
								});
			})
		})(jQuery)
	</script>
</body>

</html>
